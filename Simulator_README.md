## Dependencies

- Simulation of dynamics:
  - Numpy
  - Math
  - SciPy
- GUI:
  - Matplotlib
  - Matplotlib Mapping Toolkits
- Threading:
  - Time
  - Datetime
  - Threading

## Folder Contents

| File                  | Description                                                                              |
| --------------------- | ---------------------------------------------------------------------------------------- |
| `udp_quad.py`         | Main simulator script. Runs the quadcopter simulation and broadcasts telemetry via UDP.  |
| `gui.py`              | Example GUI for visualizing the drone position and telemetry.                            |
| `listener.py`         | Simple UDP listener for telemetry. Example of receiving JSON telemetry.                  |
| `controller.py`       | Optional controller utilities for sending commands (flight mode, waypoints, PID tuning). |
| `quadcopter.py`       | Core quadcopter simulation logic (physics, PID, state update).                           |
| `quadcopter.gif`      | Animated GIF demo of the quadcopter simulation.                                          |
| `Simulator_README.md` | This file.                                                                               |

## How to run

unzip the shared folder

Navigate to the folder
cd Quadcopter_simulator

Run the main simulator
python udp_quad.py

To test receiving telemetry data (just for understanding):
python listener.py
This script listens on UDP port 9001 and prints JSON telemetry updates from the simulator.

---------Not that important to understand-------------

## Working

The main classes which define the simulator are Propeller, Quadcopter and GUI. There is also a sample Controller classes, which implements a controller for the quadcopter. The objective was to make a quadcopter dynamic simulator, which allowed us to control each motor individually. The other requirement was the ability to run the simulations in the background, hence possibly expediting the computations, commonly referred to as the headless mode. Once the simulator thread is started, the GUI may or may not be updated at the developers will. There is also a time scaling factor, which can allow the simulation to run as fast as the processor supports, and as slow as one can fall asleep doing so.

##### Propeller class

This class defines the thrust generated by a propeller of a specified size at a given speed of rotation. This was based on the equation provided on http://www.electricrcaircraftguy.com/2013/09/propeller-static-dynamic-thrust-equation.html. This was made into a separate class to enable the implementation of other multi-rotors as well.

##### Quadcopter class

This class performs the simulations of the dynamics based on the state space solution of a quadcopter. It uses 4 objects of the Propeller class to implement the quad configuration of a quadcopter. The state space representation of a quadcopter model have been adapted from Quadcopter Dynamics, Simulation, and Control by Andrew Gibiansky and Quadrotor Dynamics and Control by Randal Beard. The class is initialized using the quadcopter parameters like length of an arm, the weight of the quadcopter, radius of a sphere representing the center blob of the quadcopter, etc. It is defined in a dictionary which can be modified.

The state space is defined as: _X = [x,y,z,x_dot,y_dot,z_dot,theta,phi,gamma,theta_dot,phi_dot, gamma_dot]_. The update to the state is performed by an ODE solver from the current state to a new state over a period of _dt_ time(defined by user). It uses the _vode_ ODE solver available from the _SciPy_ library. It has an update method to update the state, which is run on a thread at intervals defined by the time scaling factor. The thread can be started by the _start_thread_ method.

It has methods to set_motor_speeds(), get_orientation(), get_position(), get_angular_rate(), get_linear_rate(), set_position() and set_orientation(), which can be used by the controller.

##### Graphical User Interface (GUI) class

The GUI initialization takes in the same quadcopter parameter directory. It is optional to pass in the get methods for position and orientation of the quadcopter to the GUI initialization. It uses _Matplotlib_ to plot a representation of the quadcopter, each update of which takes significantly more time than the quadcopter class update. It can be updated using the method update(), with the position and orientation of the quadcopter if the get methods are not defined while initializing the object.

##### Controller class

A demo to implement a controller class. It is initialized using the quadcopter object and a controller parameter dictionary. The quadcopter object is used to update the global time as well as the quadcopter state and also to set the motor speeds on the quadcopter. An example parameter dictionary is provided which defines the different constants used by the controller. The update() method updates the motor speeds based on the control algorithm. The start_thread() method initializes the thread to keep updating the controller every _update_rate_(specified by the user).

Two example implementation of controller class are provided. One is to implement a point to point controller which controls to move the quadcopter to a desired (x,y,z) location. The other is a velocity controller, which controls to set the (x,y) velocity of the quadopter as desired, while using the z to set the quadcopter altitude. The velocity controller class is inherited from the point-to-point class, since the only change is in the update method, and can be used as an example to implement other type of controllers.

## Parameters

- TIME_SCALING: Used to define how fast the simulator runs. Value of 1.0 corresponds to real-time simulations. Any smaller number makes the simulation faster and vice versa. A value of 0 runs the simulation run as fast as possible on the current hardware.
- QUAD_DYNAMICS_UPDATE: The delta time over which the dynamics of the quadcopter are updated
- CONTROLLER_DYNAMICS_UPDATE: The delta time over which the controller updates the motors (Note: Changing this value would also cause the default controller parameters to behave differently)
- QUADCOPTER(S): The parameters which define the quadcopter: initial position and orientation,length of arm, center radius, propeller size and weight.
- CONTROLLER(N)PARAMETERS: The parameters which define the controller behavior: Motor limits, Tilt limits, Yaw_Control_Limits, Throttle offset, Linear PID, Linear to Angular Scaler, Yaw_Rate_Scaler and Angular PID
- GOAL(S): The goals to loop over
